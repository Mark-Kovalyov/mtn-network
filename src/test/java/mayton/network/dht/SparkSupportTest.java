package mayton.network.dht;

import io.vavr.control.Either;
import org.junit.jupiter.api.Test;

import java.util.Optional;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

class SparkSupportTest {

    @Test
    void test() {
        String udpBody = "64313A6164323A696432303ACF7D361A318552BF4F07F887C1CF90EA111EF8C7393A696E666F5F6861736832303ACF7D344EA1600A22EFADB7FF1B27E9829D3FDCBD65313A71393A6765745F7065657273313A74323A203B313A76343A4C540102313A79313A7165";
        Optional<String> jsonOpt = SparkSupport.dumpDhtMessageToPlainJson(udpBody);
        assertEquals(jsonOpt.get(), "{\"a\":{\"id\":\"cf7d361a318552bf4f07f887c1cf90ea111ef8c7\",\"info_hash\":\"cf7d344ea1600a22efadb7ff1b27e9829d3fdcbd\"},\"q\":\"6765745f7065657273\",\"t\":\"203b\",\"v\":\"4c540102\",\"y\":\"71\"}");
    }

    @Test
    void testNonDecodedRealData() {
        String b1 = "CB824DD820FAB19B0000040BF9B742353600000000003604B999B31FCAED4BE8D0B9000001895A8EE93500050214008E5900822806178323CE222E6CB61BDB0AD31D14EA2F29A0C20C1929ED889E4459173571DE7DA29C0000000000000210000002100210642F86B2F819C196A930EDDBA9B7CD302BBD708F45811AB2E2228168C67C4140F91C4523F023336EC7BF4360ACC3350E7E226E16EBD51A174C9B87EF282F933B9E2F148228D826A58ACA4B2A889904EBC8D503E69F9BF7EE05305A260FD28C5BB67E187D4EB395E76C7228B137A30A8EFD2D7221D13AFD38047F36F75F153FF8864FFCE31DF3D44CF5FDB55213DAA3A657DEE29CC83A3FB394C6D8F48F965FE2F2EBBFD10333121A1D0B58E8FCCC3F8EF6B5937672B8370A922243BDF3BEC908E533163682FEAFECFC86FBFB22BC93E9EF5F0FF29A22B8629226CED7DD68E1A58BB6A1673AA196A89986281FDAEA60318EF5B24A6FE8548C82BFEC72C0DA09BE1F2F54C870BDBF4B8124963C945D3E998D9E317233CFE023ABF1295F6A79A055403CDC62EF9CB813180AA493345BC694C4722F9D00E64802771CAA506348810E04046E3404AECEDEA65B3E56131C9A44A38DFD568A3026364A1CAEBEA692F74114E4A8EC253C3E695BD6BD2BF9663A60F09C7C0C59783642241701B4B13EC40B3823C44A01FBA88AB825C4BE1D74CA5D77BBB05946D95D96E65AE90D6096900A5238F96748523D409F4E61D68032F58E6BEF1F1BA0BDBFDD06309DFAC00BB5167A6C7FC8F0B6A0656C047770D7A2F89717CC3BCB81C87D3A90EB5578A4B7D2B7C546421EDDD51A36C2CCA4588717275F225E298C2E9F652AAAA605AEA63EB0F4C9D77B46DC5FE7D7504054776035293C";
        String b2 = "410091C0118AB1DD0000000000100000E45A0000";
        String b3 = "4102F4CE5E08C1A67FFFFFFF0000F0002971000000080000000000000000";

        Either<String, String> res = SparkSupport.dumpDhtMessageToPlainJsonDebug(b1);
        assertTrue(res.isLeft());
        assertEquals(res.getLeft(),"unexpected character 0xCB at offset 0");

        res = SparkSupport.dumpDhtMessageToPlainJsonDebug(b2);
        assertTrue(res.isLeft());
        assertEquals(res.getLeft(),"unexpected character 0x41 at offset 0");

        res = SparkSupport.dumpDhtMessageToPlainJsonDebug(b3);
        assertTrue(res.isLeft());
        assertEquals(res.getLeft(),"unexpected character 0x41 at offset 0");
    }

}
